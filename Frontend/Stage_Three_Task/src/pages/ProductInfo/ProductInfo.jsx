import React, { useEffect, useState } from "react";
import "./ProductInfo.scss";
import { useParams } from "react-router-dom";
import Nav from "../../components/Nav/Nav";
import Footer from "../../components/Footer/Footer";
import fetchProductInfo from "../../utils/fetchProductInfo";
import { ChevronRight } from "lucide-react";
import useCart from "../../hooks/useCart";

const ProductInfo = () => {
  const { id } = useParams();
  const { addItemToCart } = useCart();

  const [productInfo, setProductInfo] = useState();
  const [extraInfo, setExtraInfo] = useState({});

  useEffect(() => {
    const fetchInfo = async () => {
      try {
        const response = await fetchProductInfo(id);
        setProductInfo(response);

        if (response?.extra_infos && response?.extra_infos.length > 0) {
          const newExtraInfo = {};
          response.extra_infos.forEach((info) => {
            newExtraInfo[info.key] = info.value;
          });
          setExtraInfo(newExtraInfo);
        }
      } catch (error) {
        console.error("Error fetching product info:", error);
      }
    };

    fetchInfo();
  }, [id]);

  const handleAddToCart = () => {
    addItemToCart(productInfo?.id);
  };


  const formatNumberWithCommas = (number) => {
    const numberString = number.toString();

    const [integerPart, decimalPart] = numberString.split(".");

    let withCommas = "";
    for (let i = 0; i < integerPart.length; i++) {
      if (i > 0 && (integerPart.length - i) % 3 === 0) {
        withCommas += ",";
      }
      withCommas += integerPart[i];
    }

    return decimalPart ? `${withCommas}.${decimalPart}` : withCommas;
  };

  return (
    <>
      <Nav />
      <div className="productInfoWrapper">
        <div className="productInfoWrap">
          <div className="breadcrumbsWrap">
            <div className="prefix">
              <span>Home</span>
              <ChevronRight />
              <span>Catalog</span>
              <ChevronRight />
              <span>Smartphones</span>
              <ChevronRight />
            </div>
            <span className="active">{productInfo?.name}</span>
          </div>
          <div className="productInfo">
            <div className="productImgWrap">
              <div className="imgSelectorWrap">
                {productInfo?.photos?.map((photo, index) => (
                  <div className="imgSelector" key={index}>
                    <img
                      src={`${process.env.REACT_APP_API_URL}/images/${photo.url}`}
                      alt=""
                    />
                  </div>
                ))}
              </div>
              <div className="productImg">
                <img
                  src={`${process.env.REACT_APP_API_URL}/images/${productInfo?.photos[0]?.url}`}
                  alt=""
                />
              </div>
            </div>
            <div className="productContent">
              <h3>{productInfo?.name}</h3>
              <span>
                #{formatNumberWithCommas(parseInt(productInfo?.current_price))}
              </span>
              <div className="storageWrap">
                <span>128GB</span>
                <span>256GB</span>
                <span>512GB</span>
                <span>1TB</span>
              </div>
              <p>{productInfo?.description}</p>
              <div className="productCta">
                <button className="wishlist">Add to Wishlist</button>
                <button className="cart" onClick={handleAddToCart}>Add to Cart</button>
              </div>
              <div className="addOns">
                <ul>
                  <li>
                    <div className="addOnSvgWrap">
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M21.4705 11.185L20.4405 9.755C20.21 9.43121 19.9056 9.16706 19.5526 8.98445C19.1995 8.80184 18.808 8.70604 18.4105 8.705H14.0305V6.565C14.0305 5.90196 13.7672 5.26608 13.2983 4.79724C12.8295 4.32839 12.1936 4.065 11.5305 4.065H4.56055C3.89807 4.06685 3.26326 4.33083 2.79482 4.79928C2.32638 5.26772 2.06239 5.90253 2.06055 6.565V16.505C2.06055 16.9028 2.21858 17.2844 2.49989 17.5657C2.78119 17.847 3.16272 18.005 3.56055 18.005H4.78055C4.85606 18.54 5.12225 19.0298 5.53015 19.3842C5.93805 19.7385 6.46021 19.9337 7.00055 19.9337C7.54088 19.9337 8.06304 19.7385 8.47094 19.3842C8.87884 19.0298 9.14504 18.54 9.22055 18.005H14.7805C14.8561 18.54 15.1223 19.0298 15.5302 19.3842C15.9381 19.7385 16.4602 19.9337 17.0005 19.9337C17.5409 19.9337 18.063 19.7385 18.4709 19.3842C18.8788 19.0298 19.145 18.54 19.2205 18.005H20.4405C20.8384 18.005 21.2199 17.847 21.5012 17.5657C21.7825 17.2844 21.9405 16.9028 21.9405 16.505V12.635C21.9381 12.1146 21.7739 11.6079 21.4705 11.185ZM7.00055 18.935C6.75332 18.935 6.51165 18.8617 6.30608 18.7243C6.10052 18.587 5.94031 18.3918 5.8457 18.1634C5.75109 17.9349 5.72633 17.6836 5.77457 17.4411C5.8228 17.1987 5.94185 16.9759 6.11666 16.8011C6.29148 16.6263 6.51421 16.5073 6.75668 16.459C6.99916 16.4108 7.25049 16.4355 7.4789 16.5302C7.70731 16.6248 7.90253 16.785 8.03988 16.9905C8.17724 17.1961 8.25055 17.4378 8.25055 17.685C8.25055 18.0165 8.11885 18.3345 7.88443 18.5689C7.65001 18.8033 7.33207 18.935 7.00055 18.935ZM13.0305 17.005H9.15055C9.00494 16.5491 8.71821 16.1513 8.33175 15.8691C7.94529 15.5868 7.47911 15.4347 7.00055 15.4347C6.52198 15.4347 6.05581 15.5868 5.66935 15.8691C5.28289 16.1513 4.99615 16.5491 4.85055 17.005H3.56055C3.42794 17.005 3.30076 16.9523 3.20699 16.8586C3.11323 16.7648 3.06055 16.6376 3.06055 16.505V6.565C3.06055 6.16718 3.21858 5.78565 3.49989 5.50434C3.78119 5.22304 4.16272 5.065 4.56055 5.065H11.5305C11.9284 5.065 12.3099 5.22304 12.5912 5.50434C12.8725 5.78565 13.0305 6.16718 13.0305 6.565V17.005ZM17.0005 18.935C16.7533 18.935 16.5116 18.8617 16.3061 18.7243C16.1005 18.587 15.9403 18.3918 15.8457 18.1634C15.7511 17.9349 15.7263 17.6836 15.7746 17.4411C15.8228 17.1987 15.9418 16.9759 16.1167 16.8011C16.2915 16.6263 16.5142 16.5073 16.7567 16.459C16.9992 16.4108 17.2505 16.4355 17.4789 16.5302C17.7073 16.6248 17.9025 16.785 18.0399 16.9905C18.1772 17.1961 18.2505 17.4378 18.2505 17.685C18.2505 18.0165 18.1189 18.3345 17.8844 18.5689C17.65 18.8033 17.3321 18.935 17.0005 18.935ZM20.9405 16.505C20.9405 16.6376 20.8879 16.7648 20.7941 16.8586C20.7003 16.9523 20.5732 17.005 20.4405 17.005H19.1505C19.0049 16.5491 18.7182 16.1513 18.3317 15.8691C17.9453 15.5868 17.4791 15.4347 17.0005 15.4347C16.522 15.4347 16.0558 15.5868 15.6693 15.8691C15.2829 16.1513 14.9962 16.5491 14.8505 17.005H14.0305V9.705H18.4105C18.6491 9.7066 18.884 9.76449 19.096 9.87396C19.308 9.98344 19.4911 10.1414 19.6305 10.335L20.6605 11.765C20.8405 12.0196 20.9382 12.3232 20.9405 12.635V16.505Z"
                          fill="#2A364D"
                        />
                        <path
                          d="M18.0293 12.205H16.0293C15.8967 12.205 15.7695 12.1523 15.6757 12.0586C15.582 11.9648 15.5293 11.8376 15.5293 11.705C15.5293 11.5724 15.582 11.4452 15.6757 11.3515C15.7695 11.2577 15.8967 11.205 16.0293 11.205H18.0293C18.1619 11.205 18.2891 11.2577 18.3828 11.3515C18.4766 11.4452 18.5293 11.5724 18.5293 11.705C18.5293 11.8376 18.4766 11.9648 18.3828 12.0586C18.2891 12.1523 18.1619 12.205 18.0293 12.205Z"
                          fill="#2A364D"
                        />
                      </svg>
                    </div>
                    <div className="addOnTextWrap">
                      <p>Free delivery</p>
                      <span>1-2 days</span>
                    </div>
                  </li>
                  <li>
                    <div className="addOnSvgWrap">
                      <svg
                        width="25"
                        height="24"
                        viewBox="0 0 25 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          fillRule="evenodd"
                          clipRule="evenodd"
                          d="M7.76924 1.25H16.8987C17.4686 1.24998 17.9526 1.24997 18.3525 1.29132C18.7783 1.33534 19.1718 1.43094 19.5436 1.66071C19.9154 1.89048 20.1769 2.19971 20.4067 2.56088C20.6225 2.9001 20.8389 3.33297 21.0938 3.8428L21.1103 3.87574C21.12 3.89518 21.1289 3.91504 21.1369 3.93526L22.5405 7.4834C22.7075 7.90559 22.8926 8.4323 22.9467 8.97128C23.0021 9.52258 22.9261 10.1541 22.4941 10.7019C22.1408 11.15 21.6495 11.4863 21.084 11.6463V21.25H22.334C22.7482 21.25 23.084 21.5858 23.084 22C23.084 22.4142 22.7482 22.75 22.334 22.75H2.33398C1.91977 22.75 1.58398 22.4142 1.58398 22C1.58398 21.5858 1.91977 21.25 2.33398 21.25H3.58398V11.6464C3.01844 11.4863 2.5271 11.15 2.17373 10.7019C1.74177 10.1541 1.6658 9.52257 1.72116 8.97127C1.77528 8.43229 1.96037 7.90559 2.12738 7.4834L3.53099 3.93526C3.53899 3.91504 3.54786 3.89518 3.55759 3.87574L3.57408 3.84275C3.82896 3.33295 4.04537 2.90009 4.26121 2.56088C4.49102 2.19971 4.75251 1.89048 5.12429 1.66071C5.49606 1.43094 5.88959 1.33534 6.3154 1.29132C6.71532 1.24997 7.19927 1.24998 7.76924 1.25ZM18.3339 10.8875C18.6699 11.2433 19.0998 11.5096 19.584 11.6465V21.25H15.584V18.4678C15.584 18.028 15.584 17.6486 15.5558 17.3374C15.526 17.0082 15.4599 16.6822 15.2826 16.375C15.0851 16.033 14.801 15.7489 14.459 15.5514C14.1518 15.3741 13.8258 15.308 13.4967 15.2782C13.1854 15.25 12.806 15.25 12.3662 15.25H12.3018C11.862 15.25 11.4826 15.25 11.1713 15.2782C10.8422 15.308 10.5162 15.3741 10.209 15.5514C9.86694 15.7489 9.5829 16.033 9.38542 16.375C9.20805 16.6822 9.142 17.0082 9.11216 17.3374C9.08395 17.6486 9.08396 18.028 9.08398 18.4677V21.25H5.08398V11.6465C5.56811 11.5095 5.99796 11.2433 6.3339 10.8875C6.83528 11.4186 7.54588 11.75 8.33389 11.75C9.12191 11.75 9.83251 11.4186 10.3339 10.8875C10.8353 11.4186 11.5459 11.75 12.3339 11.75C13.1219 11.75 13.8325 11.4186 14.3339 10.8875C14.8353 11.4186 15.5459 11.75 16.3339 11.75C17.1219 11.75 17.8325 11.4186 18.3339 10.8875ZM10.584 21.25H14.084V18.5C14.084 18.0189 14.0833 17.7082 14.0619 17.4727C14.0415 17.2476 14.0071 17.1659 13.9835 17.125C13.9177 17.011 13.823 16.9163 13.709 16.8505C13.6681 16.8269 13.5864 16.7925 13.3613 16.7721C13.1258 16.7507 12.8151 16.75 12.334 16.75C11.8529 16.75 11.5422 16.7507 11.3067 16.7721C11.0816 16.7925 10.9999 16.8269 10.959 16.8505C10.845 16.9163 10.7503 17.011 10.6845 17.125C10.6609 17.1659 10.6265 17.2476 10.6061 17.4727C10.5847 17.7082 10.584 18.0189 10.584 18.5V21.25ZM7.08389 9C7.08389 9.69036 7.64354 10.25 8.33389 10.25C9.02425 10.25 9.58389 9.69036 9.58389 9C9.58389 8.58579 9.91968 8.25 10.3339 8.25C10.7481 8.25 11.0839 8.58579 11.0839 9C11.0839 9.69036 11.6436 10.25 12.3339 10.25C13.0243 10.25 13.5839 9.69036 13.5839 9C13.5839 8.58579 13.9197 8.25 14.3339 8.25C14.7481 8.25 15.0839 8.58579 15.0839 9C15.0839 9.69036 15.6436 10.25 16.3339 10.25C17.0243 10.25 17.5839 9.69036 17.5839 9C17.5839 8.58579 17.9197 8.25 18.3339 8.25C18.7481 8.25 19.0839 8.58579 19.0839 9C19.0839 9.69036 19.6436 10.25 20.3339 10.25C20.7319 10.25 21.0862 10.0649 21.3163 9.77305C21.4302 9.62859 21.4853 9.43094 21.4542 9.12114C21.4219 8.79903 21.303 8.43275 21.1457 8.03518L19.7541 4.51739C19.4864 3.98204 19.3075 3.62749 19.1411 3.36612C18.9812 3.1147 18.8665 3.00562 18.755 2.93669C18.6435 2.86776 18.4946 2.81401 18.1982 2.78336C17.8845 2.75093 17.4786 2.75 16.8618 2.75H7.80612C7.18931 2.75 6.78338 2.75093 6.46967 2.78336C6.17325 2.81401 6.02442 2.86776 5.91288 2.93669C5.80135 3.00562 5.68672 3.1147 5.52674 3.36612C5.36044 3.62749 5.18153 3.98204 4.91381 4.51739L3.52221 8.03518C3.36493 8.43275 3.246 8.79903 3.21365 9.12115C3.18254 9.43095 3.23764 9.62861 3.35157 9.77307C3.58168 10.0649 3.93594 10.25 4.33389 10.25C5.02425 10.25 5.58389 9.69036 5.58389 9C5.58389 8.58579 5.91968 8.25 6.33389 8.25C6.74811 8.25 7.08389 8.58579 7.08389 9Z"
                          fill="#2A364D"
                        />
                      </svg>
                    </div>
                    <div className="addOnTextWrap">
                      <p>In stock</p>
                      <span>Today</span>
                    </div>
                  </li>
                  <li>
                    <div className="addOnSvgWrap">
                      <svg
                        width="25"
                        height="24"
                        viewBox="0 0 25 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M11.4566 15.17C11.2566 15.17 11.0666 15.09 10.9266 14.95L8.50656 12.53C8.21656 12.24 8.21656 11.76 8.50656 11.47C8.79656 11.18 9.27656 11.18 9.56656 11.47L11.4566 13.36L15.7566 9.06003C16.0466 8.77003 16.5266 8.77003 16.8166 9.06003C17.1066 9.35003 17.1066 9.83003 16.8166 10.12L11.9866 14.95C11.8466 15.09 11.6566 15.17 11.4566 15.17Z"
                          fill="#2A364D"
                        />
                        <path
                          d="M12.6669 22.75C12.0369 22.75 11.4069 22.54 10.9169 22.12L9.33687 20.76C9.17687 20.62 8.77687 20.48 8.56687 20.48H6.84687C5.36687 20.48 4.16687 19.28 4.16687 17.8V16.09C4.16687 15.88 4.02688 15.49 3.88687 15.33L2.53687 13.74C1.71688 12.77 1.71688 11.24 2.53687 10.27L3.88687 8.68C4.02688 8.52 4.16687 8.13 4.16687 7.92V6.2C4.16687 4.72 5.36687 3.52 6.84687 3.52H8.57687C8.78687 3.52 9.18687 3.37 9.34687 3.24L10.9269 1.88C11.9069 1.04 13.4369 1.04 14.4169 1.88L15.9969 3.24C16.1569 3.38 16.5569 3.52 16.7669 3.52H18.4669C19.9469 3.52 21.1469 4.72 21.1469 6.2V7.9C21.1469 8.11 21.2969 8.51 21.4369 8.67L22.7969 10.25C23.6369 11.23 23.6369 12.76 22.7969 13.74L21.4369 15.32C21.2969 15.48 21.1469 15.88 21.1469 16.09V17.79C21.1469 19.27 19.9469 20.47 18.4669 20.47H16.7669C16.5569 20.47 16.1569 20.62 15.9969 20.75L14.4169 22.11C13.9269 22.54 13.2969 22.75 12.6669 22.75ZM6.84687 5.02C6.19687 5.02 5.66687 5.55 5.66687 6.2V7.91C5.66687 8.48 5.39687 9.21 5.02687 9.64L3.67687 11.23C3.32687 11.64 3.32687 12.35 3.67687 12.76L5.02687 14.35C5.39687 14.79 5.66687 15.51 5.66687 16.08V17.79C5.66687 18.44 6.19687 18.97 6.84687 18.97H8.57687C9.15687 18.97 9.88687 19.24 10.3269 19.62L11.9069 20.98C12.3169 21.33 13.0369 21.33 13.4469 20.98L15.0269 19.62C15.4669 19.25 16.1969 18.97 16.7769 18.97H18.4769C19.1269 18.97 19.6569 18.44 19.6569 17.79V16.09C19.6569 15.51 19.9269 14.78 20.3069 14.34L21.6669 12.76C22.0169 12.35 22.0169 11.63 21.6669 11.22L20.3069 9.64C19.9269 9.2 19.6569 8.47 19.6569 7.89V6.2C19.6569 5.55 19.1269 5.02 18.4769 5.02H16.7769C16.1969 5.02 15.4669 4.75 15.0269 4.37L13.4469 3.01C13.0369 2.66 12.3169 2.66 11.9069 3.01L10.3269 4.38C9.88687 4.75 9.14687 5.02 8.57687 5.02H6.84687Z"
                          fill="#2A364D"
                        />
                      </svg>
                    </div>
                    <div className="addOnTextWrap">
                      <p>Guaranteed</p>
                      <span>1 year</span>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div className="productDetailsWrap">
            <div className="productDetail">
              <h5>Details</h5>
              <span>{extraInfo.details}</span>
            </div>
            <div className="productDetail">
              <h5>Display</h5>
              <ul>
                <li>
                  <span>Screen Size</span>
                  <span>{extraInfo.screenSize}</span>
                </li>
                <li>
                  <span>Screen Type</span>
                  <span>{extraInfo.screenType}</span>
                </li>
                <li>
                  <span>Refresh Rate</span>
                  <span>{extraInfo.refreshRate}</span>
                </li>
                <li>
                  <span>Screen Resolution</span>
                  <span>{extraInfo.screenResolution}</span>
                </li>
              </ul>
            </div>
            <div className="productDetail">
              <h5>Processor</h5>
              <ul>
                <li>
                  <span>CPU</span>
                  <span>{extraInfo.cpu}</span>
                </li>
                <li>
                  <span>GPU</span>
                  <span>{extraInfo.gpu}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <Footer />
    </>
  );
};

export default ProductInfo;
